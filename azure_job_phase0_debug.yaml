$schema: https://azuremlschemas.azureedge.net/latest/commandJob.schema.json

display_name: phase0-debug-20steps
description: >
  GRubrics-Transfer Phase 0 debug: 20 steps de GRPO con Qwen2.5-0.5B + LoRA.
  Valida que el pipeline veRL funciona end-to-end antes de correr produccion.

compute: azureml:YT404321-gpu

environment:
  image: mcr.microsoft.com/azureml/openmpi4.1.0-cuda12.4-cudnn9-ubuntu22.04:latest

code: .

command: |
  set -e

  echo "=== [1/4] Setup environment ==="
  bash setup_env.sh

  echo "=== [2/4] Generate debug parquet ==="
  python -m grubrics_science.data.prepare single \
      --dataset gsm8k \
      --output_dir ./data/processed/test/

  echo "=== [3/4] Run veRL GRPO debug (20 steps) ==="
  python run_grpo.py --config grubrics_science/configs/verl_grpo_debug.yaml

  echo "=== [4/4] Done ==="
  echo "Phase 0 debug completed successfully."
