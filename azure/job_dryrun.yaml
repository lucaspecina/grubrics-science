$schema: https://azuremlschemas.azureedge.net/latest/commandJob.schema.json

display_name: grubrics-dryrun-3steps
description: >
  GRubrics-Transfer dry run: 3 steps de GRPO con Qwen2.5-0.5B + LoRA.
  Valida que el pipeline veRL funciona end-to-end antes de correr produccion.

compute: azureml:YT404321-gpu

environment:
  image: mcr.microsoft.com/azureml/openmpi4.1.0-cuda12.4-cudnn9-ubuntu22.04:latest

code: .

command: |
  set -e

  echo "=== [1/4] Setup environment ==="
  bash setup_env.sh

  echo "=== [2/4] Generate HealthBench parquet ==="
  python -m grubrics_science.data.prepare preset \
      --output_dir ./data/processed/ --only-cached

  echo "=== [3/4] Run veRL GRPO dry run (3 steps) ==="
  python run_grpo.py --config configs/verl_grpo_debug.yaml

  echo "=== [4/4] Done ==="
  echo "Dry run completed successfully."
