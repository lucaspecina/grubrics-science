$schema: https://azuremlschemas.azureedge.net/latest/commandJob.schema.json

display_name: phase0-prod-gsm8k-2000steps
description: >
  GRubrics-Transfer Phase 0 produccion: 2000 steps de GRPO con Qwen3-8B + LoRA
  + vLLM en H100. Solo correr despues de que el debug job termine sin errores.

compute: azureml:YT404321-gpu

environment:
  image: mcr.microsoft.com/azureml/openmpi4.1.0-cuda12.4-cudnn9-ubuntu22.04:latest

code: .

command: |
  set -e

  echo "=== [1/4] Setup environment ==="
  bash setup_env.sh

  echo "=== [2/4] Generate GSM8K parquet ==="
  python -m grubrics_science.data.prepare single \
      --dataset gsm8k \
      --output_dir ./data/processed/

  echo "=== [3/4] Run veRL GRPO production (2000 steps) ==="
  python run_grpo.py --config grubrics_science/configs/verl_grpo.yaml

  echo "=== [4/4] Done ==="
  echo "Phase 0 production completed successfully."
